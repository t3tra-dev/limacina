{% extends "base.html" %}

{% block content %}
<div class="container my-5">
  <!-- タイトルとタグ、編集ボタン等のヘッダー部分 -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="mb-0">{{ post.title }}</h1>
      <small class="text-muted">
        {% if tags %}
          {% for tag in tags %}
            <span class="badge bg-secondary">{{ tag }}</span>
          {% endfor %}
        {% endif %}
      </small>
    </div>
    <!-- 自分の投稿であれば編集と削除ボタン -->
    {% if is_own_post %}
    <div>
      <a href="{{ url_for('post.edit', post_id=post.id) }}" class="btn btn-sm btn-primary me-2">
        <i class="bi bi-pencil"></i> 編集
      </a>
      <form action="{{ url_for('post.delete', post_id=post.id) }}" method="POST" 
            class="d-inline" onsubmit="return confirm('本当に削除しますか？');">
        <button type="submit" class="btn btn-sm btn-danger">
          <i class="bi bi-trash"></i> 削除
        </button>
      </form>
    </div>
    {% endif %}
  </div>

  <!-- 投稿説明 -->
  {% if post.description %}
    <p class="lead">{{ post.description }}</p>
    <hr>
  {% endif %}

  <!-- メディア一覧 -->
  <div class="row g-4">
    {% for media in processed_media %}
      <div class="col-12">
        {% if media.type == "image" %}
          <!-- 画像の場合 -->
          <img src="{{ media.source }}" class="img-fluid rounded" alt="投稿画像">
        {% elif media.type == "youtube" %}
          <!-- YouTube埋め込み -->
          <div class="ratio ratio-16x9">
            <iframe src="{{ media.source }}" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
            </iframe>
          </div>
        {% elif media.type == "gist" %}
          <!-- Gist埋め込み -->
          <script src="{{ media.source }}"></script>
        {% endif %}
      </div>
    {% endfor %}
  </div>

  <hr>

  <!-- 投稿情報 -->
  <div class="text-muted">
    <small>
      投稿者: <a href="{{ url_for('user.profile', screen_name=post.author.screen_name) }}" 
               class="text-decoration-none">{{ post.author.name }}</a><br>
      投稿日時: {{ post.created_at.strftime('%Y年%m月%d日 %H:%M') }}
    </small>
  </div>
</div>
{% endblock %}
